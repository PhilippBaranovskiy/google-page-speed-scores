module.exports=function(){var e="undefined"!=typeof window?window:self,t=require("pinkyswear"),n=require("jquery-param"),r={},o="json",s="post",a=null,i=0,p=[],u=e.XMLHttpRequest?function(){return new e.XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},c=""===u().responseType,f=function(f,l,d,y,T){f=f.toUpperCase(),d=d||null,y=y||{};for(var h in r)if(!(h in y))if("object"==typeof r[h]&&"object"==typeof y[h])for(var m in r[h])y[h][m]=r[h][m];else y[h]=r[h];var w,x,v,b,g,C=!1,q=!1,O=!1,j=0,D={},M={text:"*/*",xml:"text/xml",json:"application/json",post:"application/x-www-form-urlencoded",document:"text/html"},X={text:"*/*",xml:"application/xml; q=1.0, text/xml; q=0.8, */*; q=0.1",json:"application/json; q=1.0, text/*; q=0.8, */*; q=0.1"},E=!1,L=t(function(t){return t.abort=function(){O||(x&&4!=x.readyState&&x.abort(),E&&(--i,E=!1),O=!0)},t.send=function(){if(!E){if(i==a)return void p.push(t);if(O)return void(p.length&&p.shift().send());if(++i,E=!0,x=u(),w&&("withCredentials"in x||!e.XDomainRequest||(x=new XDomainRequest,q=!0,"GET"!=f&&"POST"!=f&&(f="POST"))),q?x.open(f,l):(x.open(f,l,y.async,y.user,y.password),c&&y.async&&(x.withCredentials=y.withCredentials)),!q)for(var n in D)D[n]&&x.setRequestHeader(n,D[n]);if(c&&"auto"!=y.responseType)try{x.responseType=y.responseType,C=x.responseType==y.responseType}catch(e){}c||q?(x.onload=R,x.onerror=S,q&&(x.onprogress=function(){})):x.onreadystatechange=function(){4==x.readyState&&R()},y.async?"timeout"in x?(x.timeout=y.timeout,x.ontimeout=P):v=setTimeout(P,y.timeout):q&&(x.ontimeout=function(){}),"auto"!=y.responseType&&"overrideMimeType"in x&&x.overrideMimeType(M[y.responseType]),T&&T(x),q?setTimeout(function(){x.send("GET"!=f?d:null)},0):x.send("GET"!=f?d:null)}},t}),R=function(){var t;if(E=!1,clearTimeout(v),p.length&&p.shift().send(),!O){--i;try{if(C){if("response"in x&&null===x.response)throw"The request response is empty";g=x.response}else{if(t=y.responseType,"auto"==t)if(q)t=o;else{var n=x.getResponseHeader("Content-Type")||"";t=n.indexOf(M.json)>-1?"json":n.indexOf(M.xml)>-1?"xml":"text"}switch(t){case"json":if(x.responseText.length)try{g="JSON"in e?JSON.parse(x.responseText):new Function("return ("+x.responseText+")")()}catch(e){throw"Error while parsing JSON body : "+e}break;case"xml":try{e.DOMParser?g=(new DOMParser).parseFromString(x.responseText,"text/xml"):(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(x.responseText))}catch(e){g=void 0}if(!g||!g.documentElement||g.getElementsByTagName("parsererror").length)throw"Invalid XML";break;default:g=x.responseText}}if("status"in x&&!/^2|1223/.test(x.status))throw x.status+" ("+x.statusText+")";L(!0,[x,g])}catch(e){L(!1,[e,x,g])}}},S=function(e){O||(e="string"==typeof e?e:"Connection aborted",L.abort(),L(!1,[new Error(e),x,null]))},P=function(){O||(y.attempts&&++j==y.attempts?S("Timeout ("+l+")"):(x.abort(),E=!1,L.send()))};if(y.async=!("async"in y)||!!y.async,y.cache="cache"in y&&!!y.cache,y.dataType="dataType"in y?y.dataType.toLowerCase():s,y.responseType="responseType"in y?y.responseType.toLowerCase():"auto",y.user=y.user||"",y.password=y.password||"",y.withCredentials=!!y.withCredentials,y.timeout="timeout"in y?parseInt(y.timeout,10):3e4,y.attempts="attempts"in y?parseInt(y.attempts,10):1,b=l.match(/\/\/(.+?)\//),w=b&&!!b[1]&&b[1]!=location.host,"ArrayBuffer"in e&&d instanceof ArrayBuffer?y.dataType="arraybuffer":"Blob"in e&&d instanceof Blob?y.dataType="blob":"Document"in e&&d instanceof Document?y.dataType="document":"FormData"in e&&d instanceof FormData&&(y.dataType="formdata"),null!==d)switch(y.dataType){case"json":d=JSON.stringify(d);break;case"post":d=n(d)}if(y.headers){var A=function(e,t,n){return t+n.toUpperCase()};for(b in y.headers)D[b.replace(/(^|-)([^-])/g,A)]=y.headers[b]}return"Content-Type"in D||"GET"==f||y.dataType in M&&M[y.dataType]&&(D["Content-Type"]=M[y.dataType]),D.Accept||(D.Accept=y.responseType in X?X[y.responseType]:"*/*"),w||"X-Requested-With"in D||(D["X-Requested-With"]="XMLHttpRequest"),y.cache||"Cache-Control"in D||(D["Cache-Control"]="no-cache"),"GET"==f&&d&&"string"==typeof d&&(l+=(/\?/.test(l)?"&":"?")+d),y.async&&L.send(),L},l=function(e){var n=[],r=0,o=[];return t(function(t){var s=-1,a=function(e){return function(a,i,p,u){var c=++s;return++r,n.push(f(e,t.base+a,i,p,u).then(function(e,n){o[c]=arguments,--r||t(!0,1==o.length?o[0]:[o])},function(){t(!1,arguments)})),t}};t.get=a("GET"),t.post=a("POST"),t.put=a("PUT"),t.delete=a("DELETE"),t.catch=function(e){return t.then(null,e)},t.complete=function(e){var n=function(){e()};return t.then(n,n)},t.map=function(e,t,n,r,o){return a(e.toUpperCase()).call(this,t,n,r,o)};for(var i in e)i in t||(t[i]=e[i]);return t.send=function(){for(var e=0,r=n.length;e<r;++e)n[e].send();return t},t.abort=function(){for(var e=0,r=n.length;e<r;++e)n[e].abort();return t},t})},d={base:"",get:function(){return l(d).get.apply(this,arguments)},post:function(){return l(d).post.apply(this,arguments)},put:function(){return l(d).put.apply(this,arguments)},delete:function(){return l(d).delete.apply(this,arguments)},map:function(){return l(d).map.apply(this,arguments)},xhr2:c,limit:function(e){return a=e,d},setDefaultOptions:function(e){return r=e,d},setDefaultXdrResponseType:function(e){return o=e.toLowerCase(),d},setDefaultDataType:function(e){return s=e.toLowerCase(),d},getOpenRequests:function(){return i}};return d}();
var googlePageSpeedScores=function(e,s){"use strict";if(e=e||[],e.length)return this.apiUrl="https://www.googleapis.com/pagespeedonline/v2/runPagespeed",this.results=[],this.fetchPromises=[],this.averageScore=function(e){var s=0,t=0;return e.forEach(function(e){s+=e.speed,t+=e.usability}),s=Math.round(s/e.length),t=Math.round(t/e.length),{speed:s,usability:t}},this.storeResult=function(e,s){var t=s.ruleGroups.SPEED,r=s.ruleGroups.USABILITY;this.results.push({speed:t.score,usability:r.score})},this.logError=function(e,s,t){console.log("logError: ",arguments)},e.forEach(function(e){var s=qwest.get(this.apiUrl,{url:e,strategy:"mobile"}).then(this.storeResult.bind(this)).catch(this.logError);this.fetchPromises.push(s),s=null}.bind(this)),Promise.all(this.fetchPromises).then(function(){s(this.averageScore(this.results))}.bind(this)).catch(function(){console.log("ALL error: ",arguments)})};